<!DOCTYPE html>
<html>
  <head>
    <title>Virtual World Framework</title>
    <script type="text/javascript">
      var gameID;

      vwf_view.initializedNode = function( nodeID, childID, childExtendsID, childImplementsIDs,
          childSource, childType, childIndex, childName ) {
        if ( childID == vwf_view.kernel.application() ) {
          gameID = vwf_view.kernel.find("", "/game")[0];
          initializeBoard();
        }
      }

      vwf_view.satProperty = function (nodeID, propertyName, propertyValue) {
        switch(propertyName) {
          case "currentTile01":
            placeTile('01');
            break;
          case "currentTile02":
            placeTile('02');
            break;
          case "currentTile03":
            placeTile('03');
            break;
          case "currentTile04":
            placeTile('04');
            break;
          case "currentTile05":
            placeTile('05');
            break;
          case "currentTile06":
            placeTile('06');
            break;
          case "currentTile07":
            placeTile('07');
            break;
          case "currentTile08":
            placeTile('08');
            break;
          case "currentTile09":
            placeTile('09');
            break;
          case "currentTile10":
            placeTile('10');
            break;
          case "currentTile11":
            placeTile('11');
            break;
          case "currentTile12":
            placeTile('12');
            break;
          case "currentTile13":
            placeTile('13');
            break;
          case "currentTile14":
            placeTile('14');
            break;
          case "currentTile15":
            placeTile('15');
            break;
        }
      }
        
      function initializeBoard() {
        placeTile('01');
        placeTile('02');
        placeTile('03');
        placeTile('04');
        placeTile('05');
        placeTile('06');
        placeTile('07');
        placeTile('08');
        placeTile('09');
        placeTile('10');
        placeTile('11');
        placeTile('12');
        placeTile('13');
        placeTile('14');
        placeTile('15');
      }
        
      function placeTile(tile) {
        var curPos = vwf.getProperty(gameID, "currentTile"+tile);
        var pos = vwf.getProperty(gameID, curPos);
        
        x = pos[0];
        y = pos[1];
        
        tile = '#'+tile;
        
        $(tile).animate({
          left:x,
          top:y
        }, 500);
      }
        
      function moveTile(tile) {
        var curPos = vwf.getProperty(gameID, "currentTile"+tile);
        var pos = vwf.getProperty(gameID, curPos);
           
        var openPos = vwf.getProperty(gameID, "openPosition");
        var new_pos = vwf.getProperty(gameID, openPos);
            
        var dx = Math.abs(pos[0] - new_pos[0]);
        var dy = Math.abs(pos[1] - new_pos[1]);

        if((dx < 120 && dy == 0) ||
           (dy < 120 && dx == 0))
        {
          vwf_view.kernel.setProperty( gameID, "currentTile"+tile, openPos );
          vwf_view.kernel.setProperty( gameID, "openPosition", curPos );
        }
      }
        
      function shuffleGame() {   
        tilePositions = ["tilePosition01", "tilePosition02", "tilePosition03", "tilePosition04", 
                         "tilePosition05", "tilePosition06", "tilePosition07", "tilePosition08", 
                         "tilePosition09", "tilePosition10", "tilePosition11", "tilePosition12", 
                         "tilePosition13", "tilePosition14", "tilePosition15", "tilePosition16"];
        tilePositions.sort(function() { return (Math.round(Math.random())-0.5); }); 
        
        vwf_view.kernel.setProperty( gameID, "currentTile01", tilePositions[0] );
        vwf_view.kernel.setProperty( gameID, "currentTile02", tilePositions[1] );
        vwf_view.kernel.setProperty( gameID, "currentTile03", tilePositions[2] );
        vwf_view.kernel.setProperty( gameID, "currentTile04", tilePositions[3] );
        vwf_view.kernel.setProperty( gameID, "currentTile05", tilePositions[4] );
        vwf_view.kernel.setProperty( gameID, "currentTile06", tilePositions[5] );
        vwf_view.kernel.setProperty( gameID, "currentTile07", tilePositions[6] );
        vwf_view.kernel.setProperty( gameID, "currentTile08", tilePositions[7] );
        vwf_view.kernel.setProperty( gameID, "currentTile09", tilePositions[8] );
        vwf_view.kernel.setProperty( gameID, "currentTile10", tilePositions[9] );
        vwf_view.kernel.setProperty( gameID, "currentTile11", tilePositions[10] );
        vwf_view.kernel.setProperty( gameID, "currentTile12", tilePositions[11] );
        vwf_view.kernel.setProperty( gameID, "currentTile13", tilePositions[12] );
        vwf_view.kernel.setProperty( gameID, "currentTile14", tilePositions[13] );
        vwf_view.kernel.setProperty( gameID, "currentTile15", tilePositions[14] );
        vwf_view.kernel.setProperty( gameID, "openPosition", tilePositions[15] );
      }
        
      function solveGame() {
        vwf_view.kernel.setProperty( gameID, "currentTile01", "tilePosition01" );
        vwf_view.kernel.setProperty( gameID, "currentTile02", "tilePosition02" );
        vwf_view.kernel.setProperty( gameID, "currentTile03", "tilePosition03" );
        vwf_view.kernel.setProperty( gameID, "currentTile04", "tilePosition04" );
        vwf_view.kernel.setProperty( gameID, "currentTile05", "tilePosition05" );
        vwf_view.kernel.setProperty( gameID, "currentTile06", "tilePosition06" );
        vwf_view.kernel.setProperty( gameID, "currentTile07", "tilePosition07" );
        vwf_view.kernel.setProperty( gameID, "currentTile08", "tilePosition08" );
        vwf_view.kernel.setProperty( gameID, "currentTile09", "tilePosition09" );
        vwf_view.kernel.setProperty( gameID, "currentTile10", "tilePosition10" );
        vwf_view.kernel.setProperty( gameID, "currentTile11", "tilePosition11" );
        vwf_view.kernel.setProperty( gameID, "currentTile12", "tilePosition12" );
        vwf_view.kernel.setProperty( gameID, "currentTile13", "tilePosition13" );
        vwf_view.kernel.setProperty( gameID, "currentTile14", "tilePosition14" );
        vwf_view.kernel.setProperty( gameID, "currentTile15", "tilePosition15" );
        vwf_view.kernel.setProperty( gameID, "openPosition", "tilePosition16" );
      }
    </script>
  </head>
  <body>
    <div style="text-align:center">
      <div id="board" style="text-align:left;background:black;width:450px;height:450px;margin:auto;position:relative">
        <span id="01" style="position:absolute"><img src="images/01.png" alt="01" onclick="moveTile('01')"/></span>
        <span id="02" style="position:absolute"><img src="images/02.png" alt="02" onclick="moveTile('02')"/></span>
        <span id="03" style="position:absolute"><img src="images/03.png" alt="03" onclick="moveTile('03')"/></span>
        <span id="04" style="position:absolute"><img src="images/04.png" alt="04" onclick="moveTile('04')"/></span>
        <span id="05" style="position:absolute"><img src="images/05.png" alt="05" onclick="moveTile('05')"/></span>
        <span id="06" style="position:absolute"><img src="images/06.png" alt="06" onclick="moveTile('06')"/></span>
        <span id="07" style="position:absolute"><img src="images/07.png" alt="07" onclick="moveTile('07')"/></span>
        <span id="08" style="position:absolute"><img src="images/08.png" alt="08" onclick="moveTile('08')"/></span>
        <span id="09" style="position:absolute"><img src="images/09.png" alt="09" onclick="moveTile('09')"/></span>
        <span id="10" style="position:absolute"><img src="images/10.png" alt="10" onclick="moveTile('10')"/></span>
        <span id="11" style="position:absolute"><img src="images/11.png" alt="11" onclick="moveTile('11')"/></span>
        <span id="12" style="position:absolute"><img src="images/12.png" alt="12" onclick="moveTile('12')"/></span>
        <span id="13" style="position:absolute"><img src="images/13.png" alt="13" onclick="moveTile('13')"/></span>
        <span id="14" style="position:absolute"><img src="images/14.png" alt="14" onclick="moveTile('14')"/></span>
        <span id="15" style="position:absolute"><img src="images/15.png" alt="15" onclick="moveTile('15')"/></span>
      </div>
      <p>
        <span style="position:relative;right:5px"><img style="border:black solid 6px" src="images/Shuffle.png" alt="Shuffle" onclick="shuffleGame()" /></span>
        <span style="position:relative;left:5px"><img style="border:black solid 6px" src="images/Solve.png" alt="Solve" onclick="solveGame()" /></span>
      </p>
    </div>
  </body>
</html>
